<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.538">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tyler Nguyen">
<meta name="dcterms.date" content="2024-03-11">

<title>Tyler’s Python Blog - Trail Recommendations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Tyler’s Python Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TylerNguyen25/PIC16B-Blog/tree/gh-pages"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Trail Recommendations</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">SpaCy</div>
                <div class="quarto-category">Word Embedding</div>
                <div class="quarto-category">Python</div>
                <div class="quarto-category">Neural Networks</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tyler Nguyen </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 11, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="project-overview" class="level1">
<h1>Project Overview</h1>
<p>Using the internet, it’s very easy to find information about hiking trails throughout the United States, but there’s a problem: it’s a lot easier to browse through lists of trails available online, like on the website trailforks.com, and filtering by location. What are you supposed to do if you don’t know much about an area but still want to go hiking, or what if you want to do certain things on your hike but don’t know where to go? You could do lots of research online yourself, reading articles or sifting through different locations, but this process can be very difficult, especially if you want to go somewhere that you’ve never been.</p>
<p>Our project addresses finding new places to visit based upon what type of hiking trails the user wants to see (which the user would describe) based upon previously hiked trails. For instance, if the user previously hiked Half Dome in Yosemite, then we give the user other trails and locations in the United States most similar to Half Dome according to reviews on TripAdvisor. This would be mainly for tourists who want to visit parts of the country they have not been to.</p>
<p>The below code is for importing images.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="webscraping-trip-advisor---tyler" class="level1">
<h1>Webscraping Trip Advisor - Tyler</h1>
<p>Here we webscrape TripAdvisor to gather reviews for semantic analysis such that we can recommend trails based upon how similar reviews are to each other. We do so using scrapy!</p>
<p>This is what the first page looks like: <img src="FinalProject (1)_files/figure-html/cell-5-1-Capture.JPG" class="img-fluid" alt="Capture.JPG"></p>
<p>The first function we write is <code>parse</code>. This function redirects users from the general national park page to the page with just activities to do.</p>
<div id="cell-7" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse(<span class="va">self</span>, response):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    next_page <span class="op">=</span> response.xpath(<span class="st">"//div//a[contains(@href, 'Attraction')]//@href"</span>).get() <span class="co">#xpath command to redirect to activities</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> response.follow(next_page, callback <span class="op">=</span> <span class="va">self</span>.parse_full_credits) <span class="co">#redirects to the new url page and executes parse_full_credits</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second function we write is <code>parse_full_credits</code>. This function redirects users from the list of all activities to each individual trail page. We do this so that we can extract reviews and information of individual trails per national park.</p>
<p>This is what the second page looks like:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FinalProject (1)_files/figure-html/cell-10-1-Capture2.JPG" class="img-fluid figure-img"></p>
<figcaption>Capture2.JPG</figcaption>
</figure>
</div>
<div id="cell-11" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_full_credits(<span class="va">self</span>, response):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    trail_page <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'BYvbL A']//a[@class = 'BUupS _R w _Z y M0 B0 Gm wSSLS']//@href"</span>).getall()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> trail <span class="kw">in</span> trail_page: <span class="co">#for every trail in the trial page list url, execute the callback command parse_actor_page</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> response.follow(trail, callback <span class="op">=</span> <span class="va">self</span>.parse_trail)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, the last function we write is <code>parse_trail</code>. This function outputs important data such as National Park name, state national park is in, trail name, overall trail rating, title of comment, text of comment, and individual comment rating.</p>
<div id="cell-13" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_trail(<span class="va">self</span>, response):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    national_park <span class="op">=</span> response.xpath(<span class="st">"//span[@class = 'fxMOE']//text()"</span>).get()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    state <span class="op">=</span> response.xpath(<span class="st">"//span[@class = 'n q']//span[@class = 'biGQs _P pZUbB avBIb osNWb']//text()"</span>).getall()[<span class="dv">1</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    trail <span class="op">=</span> response.xpath(<span class="st">"//h1//text()"</span>).get()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    comment_title <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'LbPSX']//div[@class = 'biGQs _P fiohW qWPrE ncFvv fOtGX']//span//text()"</span>).getall()</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    ratings <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'LbPSX']//svg[@class = 'UctUV d H0']//title//text()"</span>).getall()</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    comment_text <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'LbPSX']//span[@class = 'JguWG']//span[@class = 'yCeTE']//text()[1]"</span>).getall()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    pictures <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'LbPSX']//span[@class = 'biGQs _P XWJSj Wb']//img//@srcset"</span>).getall()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    overall_rating <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'biGQs _P fiohW hzzSG uuBRH']//text()"</span>).get()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    trail_type <span class="op">=</span> response.xpath(<span class="st">"//div[@class = 'biGQs _P pZUbB alXOW oCpZu GzNcM nvOhm UTQMg ZTpaU W KxBGd']//span//text()"</span>).get()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ix <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(comment_title)):</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">"national_park"</span> : national_park,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">"state"</span> : state,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"trail"</span>:trail,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>          <span class="st">"activity"</span>: trail_type,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>          <span class="st">"overall_rating"</span>: overall_rating,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">"comment_title"</span>:comment_title[ix],</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"comment_ratings"</span>:ratings[ix],</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"comment_text"</span>:comment_text[ix]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is what the trail page with reviews looks like:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="FinalProject (1)_files/figure-html/cell-15-1-Capture3.JPG" class="img-fluid figure-img"></p>
<figcaption>Capture3.JPG</figcaption>
</figure>
</div>
<p>Now, we want to get this data in <code>csv</code> format. To do so, we go to the directory which holds our spider and run <code>scrapy crawl trip_advisor -o national_parks.csv</code>. Great, now we can analyze our reviews!</p>
</section>
<section id="review-similarity-trail-recommender---tyler" class="level1">
<h1>Review Similarity Trail Recommender - Tyler</h1>
<p>Now, we utilize functions and word embedding to return the most similar trails and their location in the United States based upon the csv file we just created from our webscraper!</p>
<p>Firstly, let us import the packages we need. <code>en_core_web_lg</code> is a 560 MB model imported from SpaCy with has 514 thousand unique word vectors and reduces these vectors down to 300 dimensions for predictability. We do so to take advantage of built in word vectors so we don’t have to do this ourselves.</p>
<div id="cell-19" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gensim</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> spacy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>nlp <span class="op">=</span> spacy.load(<span class="st">'en_core_web_lg'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<p>Now let us load the data we scraped by TripAdvisor as well as a Excel file containing coordinate points of our national parks so that we can create a geograpical plot later</p>
<div id="cell-23" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'https://raw.githubusercontent.com/torwar02/trails/main/trails/national_parks.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-24" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.read_excel(<span class="st">'https://raw.githubusercontent.com/torwar02/trails/main/trails/coords.xlsx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-25" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Turned back on 3/20/21 due to ice</td>
<td>4.0 of 5 bubbles</td>
<td>I have hiked to the fire tower a few times. It...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Spectacular</td>
<td>5.0 of 5 bubbles</td>
<td>This trail was recommended in my Acadia travel...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Great Trail</td>
<td>5.0 of 5 bubbles</td>
<td>Beech Mountain Trail is one of my favorites in...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Best trail in Acadia</td>
<td>5.0 of 5 bubbles</td>
<td>We stumbled onto this trail and were very happ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Great trail for family</td>
<td>5.0 of 5 bubbles</td>
<td>My family has kids ranging from age 10 to 3. W...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Park</th>
<th data-quarto-table-cell-role="th">State(s)</th>
<th data-quarto-table-cell-role="th">Park Established</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Visitors (2018)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>44.35</td>
<td>-68.21</td>
<td>Acadia</td>
<td>Maine</td>
<td>February 26, 1919</td>
<td>49,075.26 acres (198.6 km2)</td>
<td>3537575</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-14.25</td>
<td>-170.68</td>
<td>American Samoa</td>
<td>American Samoa</td>
<td>October 31, 1988</td>
<td>8,256.67 acres (33.4 km2)</td>
<td>28626</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>38.68</td>
<td>-109.57</td>
<td>Arches</td>
<td>Utah</td>
<td>November 12, 1971</td>
<td>76,678.98 acres (310.3 km2)</td>
<td>1663557</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>43.75</td>
<td>-102.50</td>
<td>Badlands</td>
<td>South Dakota</td>
<td>November 10, 1978</td>
<td>242,755.94 acres (982.4 km2)</td>
<td>1008942</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>29.25</td>
<td>-103.25</td>
<td>Big Bend</td>
<td>Texas</td>
<td>June 12, 1944</td>
<td>801,163.21 acres (3,242.2 km2)</td>
<td>440091</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To merge the two files together, we utilize regex. Get string preceding ‘National Park’ in df such that we can merge with df2 on National Park name</p>
<div id="cell-28" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> <span class="vs">r'(.*?)(?:\s+National Park)?$'</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> re.findall(pattern, df[<span class="st">'national_park'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>park <span class="op">=</span> []</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> df[<span class="st">'national_park'</span>]:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    test_park <span class="op">=</span> re.findall(pattern, row)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    park.append(test_park[<span class="dv">0</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'park'</span>] <span class="op">=</span> park</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>national_parks <span class="op">=</span> pd.merge(df, df2, left_on<span class="op">=</span><span class="st">'park'</span>, right_on<span class="op">=</span><span class="st">'Park'</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>national_parks <span class="op">=</span> national_parks.drop(columns <span class="op">=</span> [<span class="st">'park'</span>, <span class="st">'Park'</span>, <span class="st">'State(s)'</span>, <span class="st">'Park Established'</span>])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>national_parks.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Visitors (2018)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Turned back on 3/20/21 due to ice</td>
<td>4.0 of 5 bubbles</td>
<td>I have hiked to the fire tower a few times. It...</td>
<td>44.35</td>
<td>-68.21</td>
<td>49,075.26 acres (198.6 km2)</td>
<td>3537575</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Spectacular</td>
<td>5.0 of 5 bubbles</td>
<td>This trail was recommended in my Acadia travel...</td>
<td>44.35</td>
<td>-68.21</td>
<td>49,075.26 acres (198.6 km2)</td>
<td>3537575</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Great Trail</td>
<td>5.0 of 5 bubbles</td>
<td>Beech Mountain Trail is one of my favorites in...</td>
<td>44.35</td>
<td>-68.21</td>
<td>49,075.26 acres (198.6 km2)</td>
<td>3537575</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Best trail in Acadia</td>
<td>5.0 of 5 bubbles</td>
<td>We stumbled onto this trail and were very happ...</td>
<td>44.35</td>
<td>-68.21</td>
<td>49,075.26 acres (198.6 km2)</td>
<td>3537575</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Acadia National Park</td>
<td>Maine (ME)</td>
<td>Beech Mountain Trail</td>
<td>Hiking Trails</td>
<td>4.5</td>
<td>Great trail for family</td>
<td>5.0 of 5 bubbles</td>
<td>My family has kids ranging from age 10 to 3. W...</td>
<td>44.35</td>
<td>-68.21</td>
<td>49,075.26 acres (198.6 km2)</td>
<td>3537575</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="word-embedding-and-comment-similarity-score" class="level2">
<h2 class="anchored" data-anchor-id="word-embedding-and-comment-similarity-score">Word Embedding and Comment Similarity Score</h2>
<p>First let us go over what Word Embedding is. Word embedding in NLP is an important technique that is used for representing words for text analysis in the form of real-valued vectors. In this approach, words and documents are represented in the form of numeric vectors allowing similar words to have similar vector representations. The extracted features are fed into a machine learning model so as to work with text data and preserve the semantic and syntactic information. This information once received in its converted form is used by NLP algorithms that easily digest these learned representations and process textual information.</p>
<section id="comment-similarity-function" class="level3">
<h3 class="anchored" data-anchor-id="comment-similarity-function">Comment Similarity Function</h3>
<p>Now let us create a function called <code>comment_similarity</code> which takes in our <code>national_parks.csv</code> file we just created via the <code>park_data</code> parameter, a <code>comment_index</code> parameter, and an <code>all_comments</code> parameter which is our word embedding vector representation of all comments in our csv file.</p>
<div id="cell-33" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>all_docs <span class="op">=</span> [nlp(row) <span class="cf">for</span> row <span class="kw">in</span> national_parks[<span class="st">'comment_text'</span>]] <span class="co">#getting vector representation of all comments in our csv file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> comment_similarity(parks_data, comment_index, all_comments):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    example_comment <span class="op">=</span> parks_data.loc[comment_index, <span class="st">'comment_text'</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    reference_comment <span class="op">=</span> nlp(example_comment) <span class="co">#vectorize our reference sentence</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    simularity_score <span class="op">=</span> []</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    row_id <span class="op">=</span> []</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(all_comments)):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        sim_score <span class="op">=</span> all_comments[i].similarity(reference_comment)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        simularity_score.append(sim_score)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        row_id.append(i)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    simularity_docs <span class="op">=</span> pd.DataFrame(<span class="bu">list</span>(<span class="bu">zip</span>(row_id, simularity_score)), columns <span class="op">=</span> [<span class="st">'Comment_ID'</span>, <span class="st">'sims'</span>])</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    simularity_docs_sorted <span class="op">=</span> simularity_docs.sort_values(by <span class="op">=</span> <span class="st">'sims'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    most_similar_comments <span class="op">=</span> simularity_docs_sorted[<span class="st">'Comment_ID'</span>][<span class="dv">1</span>:<span class="dv">2</span>]</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    new_reviews <span class="op">=</span> national_parks.iloc[most_similar_comments.values]</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(new_reviews)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let us show what our returned dataframe looks like</p>
<div id="cell-36" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>showcase <span class="op">=</span> comment_similarity(national_parks, <span class="dv">0</span>, all_docs)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>showcase</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Visitors (2018)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1552</td>
<td>Grand Canyon National Park</td>
<td>Arizona (AZ)</td>
<td>Grand Canyon South Rim</td>
<td>Canyons</td>
<td>5.0</td>
<td>The views do not disappoint!</td>
<td>5.0 of 5 bubbles</td>
<td>We were staying with family in Sun City (near ...</td>
<td>36.06</td>
<td>-112.14</td>
<td>1,201,647.03 acres (4,862.9 km2)</td>
<td>6380495</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we can see, we return a dataframe of the most similar review to the review with the index <code>999</code>. To see how similar this similar review is to our inputted review let us output both comments.</p>
<p>First the original comment</p>
<div id="cell-38" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>example_comment <span class="op">=</span> national_parks.loc[<span class="dv">0</span>, <span class="st">'comment_text'</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>example_comment</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>"I have hiked to the fire tower a few times. Its a great hike, and not too strenuous elevation gains.  If the NO rangers are up there ( in the summer) they used to allow you to go up the tower. We had to turn back on 3/20 because of hard pack solid ice. We had our Katoohla micro spikes on, and solid hiking poles, and knew they simply  wouldn't be enough if the ice was on the steeper sections.  We walked into the trailhead because the access road gate is still closed. After deciding to cross the lot and hike Beech Cliff Loop, which was much more clear of ice, and has excellent views of Echo Lake and the ocean out toward  Southwest Harbor. We returned to BH to hear of the recovery of a young couple from Rutland Massachusetts  who had fallen 100 feet to their death on Dorr Mountain Gorge Trail. The tragedy attributed to ice on the trails. Anyone not experienced with full crampon travel, and ice climbing training should never attempt to hike or climb on solid ice. The danger is severe.. "</code></pre>
</div>
</div>
<p>Now the similar comment.</p>
<div id="cell-40" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>showcase[<span class="st">'comment_text'</span>].iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>'We were staying with family in Sun City (near the Phoenix airport) and drove in our rental vehicle the approximate 3.5 hour drive to the south entrance of the Grand Canyon.  The park entrance was easy to find.  Parking this year was $35/vehicle.  I was skeptical going in, as several friends had this excursion on their "bucket list" while others simply raved.  I worried I would be disappointed.  However, the views absolutely spectacular!  We self-guided/toured.  We both experienced some vertigo and were careful to hang on to the railings provided, or sit on available benches as needed. Also bring water.  With the high elevation, it is easier to get winded, and water helps. We did have a hiker in front of us fall a few times from experiencing vertigo,and with assistance from others were able to help him get off the stairs and onto level ground to sit down.  He was embarrassed but grateful.  It could (and does) happen to anyone.  There were some areas that were roped off due to ice and snow and I was amazed how many people stupidly ignored the warnings and bypassed the barriers to get closer to the edge of the Canyon for selfies!   Check the weather in advance and dress appropriately.  The temperature was 30 degrees cooler in the Canyon than in the Phoenix area.  There were many families present and some pushing young ones in strollers.  On Feb 10, it was a chilly, windy, 40 degrees F.   There are lots of signs at various points educating you on the history of rocks, the Colorado river running through the Canyon, etc., and a small museum you can enter about 1.5 hours into the walk.  After our hike, we were exhausted and wind blown, and caught a shuttle back to the parking lot.  Kudos to those who can manage to walk the entire thing.  We didn\'t see everything the south side had to offer.  In our vehicle, we exited the park from the east side and for some 50+ miles, still saw the Grand Canyon from out the driver\'s side window. There were several spots along the way to stop and take more photos.  All in all, it was a physically and mentally stimulating journey that I highly recommend.'</code></pre>
</div>
</div>
<p>As we can see the comments are very similar! They both talk about the dangers of the trail and how they both saw people fall.</p>
</section>
<section id="total-trail-simularity" class="level3">
<h3 class="anchored" data-anchor-id="total-trail-simularity">Total Trail Simularity</h3>
<p>Now let us create a function called <code>total_similarity</code> which takes in the same parameters as our last function except takes in the <code>trail</code> name instead of <code>comment_index</code>. We do so because we want to get all 10 comments per trail. Our <code>total_similarity</code> function calls <code>comment_similarity</code> to get the most similar comment per each individual comment of the 10 trails. As a result, we get 10 total similar trails returned to us.</p>
<div id="cell-44" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> total_similarity(trail, parks_data, all_comments):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    trail_subset <span class="op">=</span> parks_data[parks_data[<span class="st">'trail'</span>] <span class="op">==</span> trail].index</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    total_df <span class="op">=</span> []</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> number <span class="kw">in</span> trail_subset:</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        total_df.append(comment_similarity(national_parks, number, all_docs))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.concat(total_df)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-45" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> total_similarity(<span class="st">"Landscape Arch"</span>, national_parks, all_docs)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Visitors (2018)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">303</td>
<td>Badlands National Park</td>
<td>South Dakota (SD)</td>
<td>Pinnacles Overlook</td>
<td>Points of Interest &amp; Landmarks</td>
<td>5.0</td>
<td>Must See Pullover</td>
<td>5.0 of 5 bubbles</td>
<td>This is one of a handful of overlooks you have...</td>
<td>43.75</td>
<td>-102.50</td>
<td>242,755.94 acres (982.4 km2)</td>
<td>1008942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">235</td>
<td>Arches National Park</td>
<td>Utah (UT)</td>
<td>Delicate Arch</td>
<td>Points of Interest &amp; Landmarks</td>
<td>5.0</td>
<td>Delicate Arch</td>
<td>5.0 of 5 bubbles</td>
<td>Our family chose to hike to Delicate Arch late...</td>
<td>38.68</td>
<td>-109.57</td>
<td>76,678.98 acres (310.3 km2)</td>
<td>1663557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">863</td>
<td>Capitol Reef National Park</td>
<td>Utah (UT)</td>
<td>Capitol Reef National Park</td>
<td>National Parks</td>
<td>4.5</td>
<td>Add Capitol Reef to Your Utah National Park List</td>
<td>5.0 of 5 bubbles</td>
<td>Just to the northeast of more popular parks Br...</td>
<td>38.20</td>
<td>-111.17</td>
<td>241,904.50 acres (979.0 km2)</td>
<td>1227627</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1310</td>
<td>Death Valley National Park</td>
<td>California (CA)</td>
<td>Zabriskie Point</td>
<td>Geologic Formations</td>
<td>4.5</td>
<td>The Most Iconic Place in Death Valley</td>
<td>4.0 of 5 bubbles</td>
<td>You can't miss it. I don't mean you have to do...</td>
<td>36.24</td>
<td>-116.82</td>
<td>3,373,063.14 acres (13,650.3 km2)</td>
<td>1678660</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1611</td>
<td>Grand Teton National Park</td>
<td>Wyoming (WY)</td>
<td>Taggart Lake</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Do this hike if you want to feel like you're a...</td>
<td>5.0 of 5 bubbles</td>
<td>It's not a difficult hike and is right off the...</td>
<td>43.73</td>
<td>-110.80</td>
<td>310,044.22 acres (1,254.7 km2)</td>
<td>3491151</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">222</td>
<td>Arches National Park</td>
<td>Utah (UT)</td>
<td>Double Arch</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Easy hike</td>
<td>5.0 of 5 bubbles</td>
<td>The Double Arch is unreal. It is massive and b...</td>
<td>38.68</td>
<td>-109.57</td>
<td>76,678.98 acres (310.3 km2)</td>
<td>1663557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3198</td>
<td>Mount Rainier National Park</td>
<td>Washington (WA)</td>
<td>Sunrise Visitor Center</td>
<td>Visitor Centers</td>
<td>4.5</td>
<td>Amazing views</td>
<td>5.0 of 5 bubbles</td>
<td>Amazing hikes of all varieties. Many travel up...</td>
<td>46.85</td>
<td>-121.75</td>
<td>236,381.64 acres (956.6 km2)</td>
<td>1518491</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1439</td>
<td>Glacier National Park</td>
<td>Montana (MT)</td>
<td>Grinnell Glacier</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Incredible vies and the end-point is rewarding</td>
<td>5.0 of 5 bubbles</td>
<td>This 13 mile hike from Many Glacier to upper G...</td>
<td>48.80</td>
<td>-114.00</td>
<td>1,013,125.99 acres (4,100.0 km2)</td>
<td>2965309</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1366</td>
<td>Glacier National Park</td>
<td>Montana (MT)</td>
<td>Virginia Falls</td>
<td>Waterfalls</td>
<td>5.0</td>
<td>Magnificent Falls in Glacier National Park - w...</td>
<td>5.0 of 5 bubbles</td>
<td>This is the second falls on a hike in Glacier ...</td>
<td>48.80</td>
<td>-114.00</td>
<td>1,013,125.99 acres (4,100.0 km2)</td>
<td>2965309</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">650</td>
<td>Canyonlands National Park</td>
<td>Utah (UT)</td>
<td>Horseshoe Canyon</td>
<td>Canyons</td>
<td>5.0</td>
<td>WHOA! READ PLEASE. Things you NEED to know a...</td>
<td>5.0 of 5 bubbles</td>
<td>There are some older reviews. Some are VERY M...</td>
<td>38.20</td>
<td>-109.93</td>
<td>337,597.83 acres (1,366.2 km2)</td>
<td>739449</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As we can see we get 10 similar trails to our desired trail <code>Landscape Arch</code></p>
</section>
<section id="plotly-function" class="level3">
<h3 class="anchored" data-anchor-id="plotly-function">Plotly Function</h3>
<p>Now let us construct a geographical plot function called <code>plotting_parks</code> to get the location of these trails on a map. This is so that the user can better visualize where in the United States they may have to travel to. The function also analyzes other metrics from <code>national_parks.csv</code> such as visitors in 2018, type of activity, trail name, and overall TripAdvisor rating. This function calls <code>total_similarity</code> in order to get the dataframe with the most similar reviews!</p>
<div id="cell-49" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly <span class="im">import</span> express <span class="im">as</span> px</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> inspect</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>pio.renderers.default<span class="op">=</span><span class="st">"iframe"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-50" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plotting_parks(trail, parks_data, all_comments, <span class="op">**</span>kwargs):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> total_similarity(trail, parks_data, all_comments)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.scatter_mapbox(output, lon <span class="op">=</span> <span class="st">"Longitude"</span>, lat <span class="op">=</span> <span class="st">"Latitude"</span>, color <span class="op">=</span> <span class="st">"overall_rating"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                        color_continuous_midpoint <span class="op">=</span> <span class="fl">2.5</span>, hover_name <span class="op">=</span> <span class="st">"national_park"</span>, height <span class="op">=</span> <span class="dv">600</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                        hover_data <span class="op">=</span> [<span class="st">"Visitors (2018)"</span>, <span class="st">"activity"</span>, <span class="st">"trail"</span>, <span class="st">"overall_rating"</span>],</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                        title <span class="op">=</span> <span class="st">"Recommended National Park Trails"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                        size_max<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>                        <span class="op">**</span>kwargs,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-51" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> px.colors.diverging.RdGy_r <span class="co"># produce a color map</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plotting_parks(<span class="st">"Landscape Arch"</span>, national_parks, all_docs, mapbox_style<span class="op">=</span><span class="st">"carto-positron"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                   color_continuous_scale <span class="op">=</span> color_map)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-52" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<iframe scrolling="no" width="100%" height="620" src="iframe_figures/figure_49.html" frameborder="0" allowfullscreen=""></iframe>
</div>
</div>
<p>Great, as we can see, we get a geo plot of the most similar National Park trails in the United States to <code>Landscape Arch</code>!</p>
</section>
</section>
</section>
<section id="sql-database---zion" class="level1">
<h1>SQL Database - Zion</h1>
<p>There’s a lot of information that we scrape from TrailForks which has to be managed within a SQL datbase for easy access. For example, California has more than 16,000 trails, and for each trail, we collected 12 variables (see above), so that means that there’s more than 192,000 entries! We used <code>sqlite3</code> to easily manage a database, or rather, two: one is called <code>trails.db</code> and contains individual trails (specifically, those in California, though our original plan was to include the entire country), and one called <code>trails_new.db</code> (now that I think about it, I probably should’ve given it a different name) which contains park information, where each state has a different table.</p>
<section id="database_info.py" class="level2">
<h2 class="anchored" data-anchor-id="database_info.py">database_info.py</h2>
<p>Everything relevant to managing the datbase is stored in a different python file called <code>database_info.py</code>. Here I can show you the structure of both databases:</p>
<section id="making-the-databases" class="level3">
<h3 class="anchored" data-anchor-id="making-the-databases">Making the databases</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_db(state):</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"trails.db"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    cmd <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ss">    CREATE TABLE IF NOT EXISTS </span><span class="sc">{</span>state_name_code_name_dict[state]<span class="sc">}</span><span class="ss">(</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    name VARCHAR(255),</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="ss">    coords VARCHAR(255),</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    Distance VARCHAR(255),</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Avg time' VARCHAR(255),</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    Climb VARCHAR(255),</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="ss">    Descent VARCHAR(255),</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="ss">    Activities VARCHAR(255),</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Riding Area' VARCHAR(255),</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Difficulty Rating' VARCHAR(255),</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Dogs Allowed' VARCHAR(255),</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Local Popularity' VARCHAR(255),</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Altitude start' VARCHAR(255),</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Altitude end' VARCHAR(255),</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="ss">    Grade VARCHAR(255)</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="ss">    );</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    cursor.execute(cmd)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    cursor.close()</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    conn.close()</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_db_parks(state):</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"trails_new.db"</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    cmd <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    CREATE TABLE IF NOT EXISTS </span><span class="sc">{</span>state_name_code_name_dict[state]<span class="sc">}</span><span class="ss">(</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="ss">    Name VARCHAR(255),</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="ss">    Location VARCHAR(255),</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="ss">    Coords VARCHAR(255),</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Trails (view details)' SMALLINT(255),</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Total Distance' VARCHAR(255),</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    'State Ranking' VARCHAR(255),</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Access Road/Trail' SMALLINT(255),</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    White SMALLINT(255),</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    Green SMALLINT(255),</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    Blue SMALLINT(255),</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="ss">    Black SMALLINT(255),</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="ss">    'Double Black Diamond' SMALLINT(255),</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="ss">    Proline SMALLINT(255)</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="ss">    );</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    cursor.execute(cmd)</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    cursor.close()</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    conn.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These two functions were run in order to actually create the datbaase for the first time. They contain the variables as mentioned previously, mostly in the form of text.</p>
</section>
<section id="adding-information" class="level3">
<h3 class="anchored" data-anchor-id="adding-information">Adding information</h3>
<p>If you recall from the scraping functions, there was a function call that would add information from each park to the SQL database. Here’s the source code for those functions:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_db():</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"trails.db"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> conn</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_trails(df,state):</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> get_db()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    df.to_sql(state, conn, if_exists <span class="op">=</span> <span class="st">"append"</span>, index <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_db_new():</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"trails_new.db"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> conn</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_trails_new(df,state):</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> get_db_new()</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    df.to_sql(state, conn, if_exists <span class="op">=</span> <span class="st">"append"</span>, index <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The functions <code>get_db</code> and <code>get_db_new</code> (most things relating to <code>scraper_parks</code> are labeled <code>new</code> since we did this second) establish connections to their respective databases. <code>add_trails</code> and <code>add_trails_new</code>, therefore, are actually responsible for adding entries to each database. Note that they take a <code>df</code> as one input (which contains the scraped info) and a state name, which sends the information to the correct table.</p>
</section>
<section id="miscellaneous-tables" class="level3">
<h3 class="anchored" data-anchor-id="miscellaneous-tables">Miscellaneous Tables</h3>
<p>There are several dictionaries and lists that we generated in order to make the functions easier to run:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>states <span class="op">=</span> [<span class="st">"Alabama"</span>, <span class="st">"Alaska"</span>, <span class="st">"Arizona"</span>, <span class="st">"Arkansas"</span>, <span class="st">"California"</span>, <span class="st">"Colorado"</span>, <span class="st">"Connecticut"</span>, <span class="st">"Delaware"</span>, <span class="st">"Florida"</span>, <span class="st">"Georgia"</span>, <span class="st">"Hawaii"</span>, <span class="st">"idaho-3166"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Iowa"</span>, <span class="st">"Kansas"</span>, <span class="st">"Kentucky"</span>, <span class="st">"Louisiana"</span>, <span class="st">"Maine"</span>, <span class="st">"Maryland"</span>, <span class="st">"Massachusetts"</span>, <span class="st">"Michigan"</span>, <span class="st">"Minnesota"</span>, <span class="st">"Mississippi"</span>, <span class="st">"Missouri"</span>, <span class="st">"Montana"</span>, <span class="st">"Nebraska"</span>, <span class="st">"Nevada"</span>, <span class="st">"new-hampshire"</span>, <span class="st">"new-jersey"</span>, <span class="st">"new-mexico"</span>, <span class="st">"new-york"</span>, <span class="st">"north-carolina"</span>, <span class="st">"north-dakota"</span>, <span class="st">"Ohio"</span>, <span class="st">"Oklahoma"</span>, <span class="st">"Oregon"</span>, <span class="st">"Pennsylvania"</span>, <span class="st">"rhode-island"</span>, <span class="st">"south-carolina"</span>, <span class="st">"south-dakota"</span>, <span class="st">"Tennessee"</span>, <span class="st">"Texas"</span>, <span class="st">"Utah"</span>, <span class="st">"Vermont"</span>, <span class="st">"Virginia"</span>, <span class="st">"Washington"</span>, <span class="st">"west-virginia"</span>, <span class="st">"Wisconsin"</span>, <span class="st">"Wyoming"</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>state_name_code_name_dict <span class="op">=</span> {</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Alabama'</span>: <span class="st">'Alabama'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Alaska'</span>: <span class="st">'Alaska'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Arizona'</span>: <span class="st">'Arizona'</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Arkansas'</span>: <span class="st">'Arkansas'</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'California'</span>: <span class="st">'California'</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Colorado'</span>: <span class="st">'Colorado'</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Connecticut'</span>: <span class="st">'Connecticut'</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Delaware'</span>: <span class="st">'Delaware'</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Florida'</span>: <span class="st">'Florida'</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Georgia'</span>: <span class="st">'Georgia'</span>,</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Hawaii'</span>: <span class="st">'Hawaii'</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idaho-3166'</span>: <span class="st">'Idaho'</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Illinois'</span>: <span class="st">'Illinois'</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Indiana'</span>: <span class="st">'Indiana'</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Iowa'</span>: <span class="st">'Iowa'</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Kansas'</span>: <span class="st">'Kansas'</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Kentucky'</span>: <span class="st">'Kentucky'</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Louisiana'</span>: <span class="st">'Louisiana'</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Maine'</span>: <span class="st">'Maine'</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Maryland'</span>: <span class="st">'Maryland'</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Massachusetts'</span>: <span class="st">'Massachusetts'</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Michigan'</span>: <span class="st">'Michigan'</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Minnesota'</span>: <span class="st">'Minnesota'</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Mississippi'</span>: <span class="st">'Mississippi'</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Missouri'</span>: <span class="st">'Missouri'</span>,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Montana'</span>: <span class="st">'Montana'</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nebraska'</span>: <span class="st">'Nebraska'</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nevada'</span>: <span class="st">'Nevada'</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'new-hampshire'</span>: <span class="st">'NewHampshire'</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'new-jersey'</span>: <span class="st">'NewJersey'</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'new-mexico'</span>: <span class="st">'NewMexico'</span>,</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'new-york'</span>: <span class="st">'NewYork'</span>,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'north-carolina'</span>: <span class="st">'NorthCarolina'</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'north-dakota'</span>: <span class="st">'NorthDakota'</span>,</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ohio'</span>: <span class="st">'Ohio'</span>,</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Oklahoma'</span>: <span class="st">'Oklahoma'</span>,</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Oregon'</span>: <span class="st">'Oregon'</span>,</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pennsylvania'</span>: <span class="st">'Pennsylvania'</span>,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rhode-island'</span>: <span class="st">'RhodeIsland'</span>,</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'south-carolina'</span>: <span class="st">'SouthCarolina'</span>,</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'south-dakota'</span>: <span class="st">'SouthDakota'</span>,</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Tennessee'</span>: <span class="st">'Tennessee'</span>,</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Texas'</span>: <span class="st">'Texas'</span>,</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Utah'</span>: <span class="st">'Utah'</span>,</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vermont'</span>: <span class="st">'Vermont'</span>,</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Virginia'</span>: <span class="st">'Virginia'</span>,</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Washington'</span>: <span class="st">'Washington'</span>,</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'west-virginia'</span>: <span class="st">'WestVirginia'</span>,</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Wisconsin'</span>: <span class="st">'Wisconsin'</span>,</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Wyoming'</span>: <span class="st">'Wyoming'</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>state_dictionary <span class="op">=</span> {<span class="st">'Alabama'</span>: <span class="dv">11</span>, <span class="st">'Alaska'</span>: <span class="dv">11</span>, <span class="st">'Arizona'</span>: <span class="dv">49</span>, <span class="st">'Arkansas'</span>: <span class="dv">16</span>, <span class="st">'California'</span>: <span class="dv">152</span>, <span class="st">'Colorado'</span>: <span class="dv">69</span>, <span class="st">'Connecticut'</span>: <span class="dv">56</span>, <span class="st">'Delaware'</span>: <span class="dv">4</span>, <span class="st">'Florida'</span>: <span class="dv">18</span>, <span class="st">'Georgia'</span>: <span class="dv">17</span>, <span class="st">'Hawaii'</span>: <span class="dv">5</span>, <span class="st">'idaho-3166'</span>: <span class="dv">31</span>, <span class="st">'Illinois'</span>: <span class="dv">51</span>, <span class="st">'Indiana'</span>: <span class="dv">10</span>, <span class="st">'Iowa'</span>: <span class="dv">8</span>, <span class="st">'Kansas'</span>: <span class="dv">3</span>, <span class="st">'Kentucky'</span>: <span class="dv">9</span>, <span class="st">'Louisiana'</span>: <span class="dv">2</span>, <span class="st">'Maine'</span>: <span class="dv">27</span>, <span class="st">'Maryland'</span>: <span class="dv">16</span>, <span class="st">'Massachusetts'</span>: <span class="dv">146</span>, <span class="st">'Michigan'</span>: <span class="dv">55</span>, <span class="st">'Minnesota'</span>: <span class="dv">36</span>, <span class="st">'Mississippi'</span>: <span class="dv">3</span>, <span class="st">'Missouri'</span>: <span class="dv">11</span>, <span class="st">'Montana'</span>: <span class="dv">41</span>, <span class="st">'Nebraska'</span>: <span class="dv">3</span>, <span class="st">'Nevada'</span>: <span class="dv">16</span>, <span class="st">'new-hampshire'</span>: <span class="dv">41</span>, <span class="st">'new-jersey'</span>: <span class="dv">40</span>, <span class="st">'new-mexico'</span>: <span class="dv">25</span>, <span class="st">'new-york'</span>: <span class="dv">60</span>, <span class="st">'north-carolina'</span>: <span class="dv">26</span>, <span class="st">'north-dakota'</span>: <span class="dv">7</span>, <span class="st">'Ohio'</span>: <span class="dv">29</span>, <span class="st">'Oklahoma'</span>: <span class="dv">4</span>, <span class="st">'Oregon'</span>: <span class="dv">38</span>, <span class="st">'Pennsylvania'</span>: <span class="dv">54</span>, <span class="st">'rhode-island'</span>: <span class="dv">9</span>, <span class="st">'south-carolina'</span>: <span class="dv">6</span>, <span class="st">'south-dakota'</span>: <span class="dv">7</span>, <span class="st">'Tennessee'</span>: <span class="dv">16</span>, <span class="st">'Texas'</span>: <span class="dv">50</span>, <span class="st">'Utah'</span>: <span class="dv">62</span>, <span class="st">'Vermont'</span>: <span class="dv">25</span>, <span class="st">'Virginia'</span>: <span class="dv">27</span>, <span class="st">'Washington'</span>: <span class="dv">92</span>, <span class="st">'west-virginia'</span>: <span class="dv">18</span>, <span class="st">'Wisconsin'</span>: <span class="dv">25</span>, <span class="st">'Wyoming'</span>: <span class="dv">19</span>}</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>state_parks_dictionary <span class="op">=</span> {<span class="st">'Alabama'</span>: <span class="dv">1</span>, <span class="st">'Alaska'</span>: <span class="dv">1</span>, <span class="st">'Arizona'</span>: <span class="dv">3</span>, <span class="st">'Arkansas'</span>: <span class="dv">2</span>, <span class="st">'California'</span>: <span class="dv">8</span>, <span class="st">'Colorado'</span>: <span class="dv">4</span>, <span class="st">'Connecticut'</span>: <span class="dv">7</span>, <span class="st">'Delaware'</span>: <span class="dv">1</span>, <span class="st">'Florida'</span>: <span class="dv">2</span>, <span class="st">'Georgia'</span>: <span class="dv">2</span>, <span class="st">'Hawaii'</span>: <span class="dv">1</span>, <span class="st">'idaho-3166'</span>: <span class="dv">2</span>, <span class="st">'Illinois'</span>: <span class="dv">10</span>, <span class="st">'Indiana'</span>: <span class="dv">1</span>, <span class="st">'Iowa'</span>: <span class="dv">1</span>, <span class="st">'Kansas'</span>: <span class="dv">1</span>, <span class="st">'Kentucky'</span>: <span class="dv">1</span>, <span class="st">'Louisiana'</span>: <span class="dv">1</span>, <span class="st">'Maine'</span>: <span class="dv">3</span>, <span class="st">'Maryland'</span>: <span class="dv">1</span>, <span class="st">'Massachusetts'</span>: <span class="dv">7</span>, <span class="st">'Michigan'</span>: <span class="dv">5</span>, <span class="st">'Minnesota'</span>: <span class="dv">3</span>, <span class="st">'Mississippi'</span>: <span class="dv">1</span>, <span class="st">'Missouri'</span>: <span class="dv">2</span>, <span class="st">'Montana'</span>: <span class="dv">2</span>, <span class="st">'Nebraska'</span>: <span class="dv">1</span>, <span class="st">'Nevada'</span>: <span class="dv">1</span>, <span class="st">'new-hampshire'</span>: <span class="dv">3</span>, <span class="st">'new-jersey'</span>: <span class="dv">3</span>, <span class="st">'new-mexico'</span>: <span class="dv">2</span>, <span class="st">'new-york'</span>: <span class="dv">5</span>, <span class="st">'north-carolina'</span>: <span class="dv">3</span>, <span class="st">'north-dakota'</span>: <span class="dv">1</span>, <span class="st">'Ohio'</span>: <span class="dv">4</span>, <span class="st">'Oklahoma'</span>: <span class="dv">1</span>, <span class="st">'Oregon'</span>: <span class="dv">3</span>, <span class="st">'Pennsylvania'</span>: <span class="dv">3</span>, <span class="st">'rhode-island'</span>: <span class="dv">1</span>, <span class="st">'south-carolina'</span>: <span class="dv">1</span>, <span class="st">'south-dakota'</span>: <span class="dv">1</span>, <span class="st">'Tennessee'</span>: <span class="dv">2</span>, <span class="st">'Texas'</span>: <span class="dv">4</span>, <span class="st">'Utah'</span>: <span class="dv">3</span>, <span class="st">'Vermont'</span>: <span class="dv">2</span>, <span class="st">'Virginia'</span>: <span class="dv">2</span>, <span class="st">'Washington'</span>: <span class="dv">6</span>, <span class="st">'west-virginia'</span>: <span class="dv">2</span>, <span class="st">'Wisconsin'</span>: <span class="dv">3</span>, <span class="st">'Wyoming'</span>: <span class="dv">1</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>state_dictionary</code> and <code>state_parks_dictionary</code> store the number of pages required for each state. <code>states</code> simply contains the names of all the states in alphabetical order, and <code>state_name_code_dict</code> helps sort between the name of a state and the way in which it is displayed on TrailForks URLs.</p>
</section>
</section>
<section id="connecting-national-parks-to-individual-trailpark-info" class="level2">
<h2 class="anchored" data-anchor-id="connecting-national-parks-to-individual-trailpark-info">Connecting National Parks to Individual Trail/Park Info</h2>
<p>Now we need to make sure to connect the data that we’ve collected here with the actual table generated by the recommender to give the user more information. Let’s take a look at our output from the similarity score model:</p>
<div id="cell-55" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Visitors (2018)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">303</td>
<td>Badlands National Park</td>
<td>South Dakota (SD)</td>
<td>Pinnacles Overlook</td>
<td>Points of Interest &amp; Landmarks</td>
<td>5.0</td>
<td>Must See Pullover</td>
<td>5.0 of 5 bubbles</td>
<td>This is one of a handful of overlooks you have...</td>
<td>43.75</td>
<td>-102.50</td>
<td>242,755.94 acres (982.4 km2)</td>
<td>1008942</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">235</td>
<td>Arches National Park</td>
<td>Utah (UT)</td>
<td>Delicate Arch</td>
<td>Points of Interest &amp; Landmarks</td>
<td>5.0</td>
<td>Delicate Arch</td>
<td>5.0 of 5 bubbles</td>
<td>Our family chose to hike to Delicate Arch late...</td>
<td>38.68</td>
<td>-109.57</td>
<td>76,678.98 acres (310.3 km2)</td>
<td>1663557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">863</td>
<td>Capitol Reef National Park</td>
<td>Utah (UT)</td>
<td>Capitol Reef National Park</td>
<td>National Parks</td>
<td>4.5</td>
<td>Add Capitol Reef to Your Utah National Park List</td>
<td>5.0 of 5 bubbles</td>
<td>Just to the northeast of more popular parks Br...</td>
<td>38.20</td>
<td>-111.17</td>
<td>241,904.50 acres (979.0 km2)</td>
<td>1227627</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1310</td>
<td>Death Valley National Park</td>
<td>California (CA)</td>
<td>Zabriskie Point</td>
<td>Geologic Formations</td>
<td>4.5</td>
<td>The Most Iconic Place in Death Valley</td>
<td>4.0 of 5 bubbles</td>
<td>You can't miss it. I don't mean you have to do...</td>
<td>36.24</td>
<td>-116.82</td>
<td>3,373,063.14 acres (13,650.3 km2)</td>
<td>1678660</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1611</td>
<td>Grand Teton National Park</td>
<td>Wyoming (WY)</td>
<td>Taggart Lake</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Do this hike if you want to feel like you're a...</td>
<td>5.0 of 5 bubbles</td>
<td>It's not a difficult hike and is right off the...</td>
<td>43.73</td>
<td>-110.80</td>
<td>310,044.22 acres (1,254.7 km2)</td>
<td>3491151</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">222</td>
<td>Arches National Park</td>
<td>Utah (UT)</td>
<td>Double Arch</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Easy hike</td>
<td>5.0 of 5 bubbles</td>
<td>The Double Arch is unreal. It is massive and b...</td>
<td>38.68</td>
<td>-109.57</td>
<td>76,678.98 acres (310.3 km2)</td>
<td>1663557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3198</td>
<td>Mount Rainier National Park</td>
<td>Washington (WA)</td>
<td>Sunrise Visitor Center</td>
<td>Visitor Centers</td>
<td>4.5</td>
<td>Amazing views</td>
<td>5.0 of 5 bubbles</td>
<td>Amazing hikes of all varieties. Many travel up...</td>
<td>46.85</td>
<td>-121.75</td>
<td>236,381.64 acres (956.6 km2)</td>
<td>1518491</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1439</td>
<td>Glacier National Park</td>
<td>Montana (MT)</td>
<td>Grinnell Glacier</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Incredible vies and the end-point is rewarding</td>
<td>5.0 of 5 bubbles</td>
<td>This 13 mile hike from Many Glacier to upper G...</td>
<td>48.80</td>
<td>-114.00</td>
<td>1,013,125.99 acres (4,100.0 km2)</td>
<td>2965309</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1366</td>
<td>Glacier National Park</td>
<td>Montana (MT)</td>
<td>Virginia Falls</td>
<td>Waterfalls</td>
<td>5.0</td>
<td>Magnificent Falls in Glacier National Park - w...</td>
<td>5.0 of 5 bubbles</td>
<td>This is the second falls on a hike in Glacier ...</td>
<td>48.80</td>
<td>-114.00</td>
<td>1,013,125.99 acres (4,100.0 km2)</td>
<td>2965309</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">650</td>
<td>Canyonlands National Park</td>
<td>Utah (UT)</td>
<td>Horseshoe Canyon</td>
<td>Canyons</td>
<td>5.0</td>
<td>WHOA! READ PLEASE. Things you NEED to know a...</td>
<td>5.0 of 5 bubbles</td>
<td>There are some older reviews. Some are VERY M...</td>
<td>38.20</td>
<td>-109.93</td>
<td>337,597.83 acres (1,366.2 km2)</td>
<td>739449</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Because we have two different SQL databases, one for nation-wide park data (<code>trails_new.db</code>) and one with state-wide trail data (<code>trails.db</code>), let’s split this into two different frames.</p>
<div id="cell-57" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>california_df <span class="op">=</span> output[output[<span class="st">'state'</span>] <span class="op">==</span> <span class="st">'California (CA)'</span>]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>non_california_df <span class="op">=</span> output[output[<span class="st">'state'</span>] <span class="op">!=</span> <span class="st">'California (CA)'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we’ll get our databases in our notebook:</p>
<p>There’s a bit of an issue, though. Let’s look at our table names:</p>
<div id="cell-60" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>db_path <span class="op">=</span> <span class="st">'trails_new.db'</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_path) <span class="co">#Establish connection with DB</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>cur <span class="op">=</span> conn.cursor()</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>cur.execute(<span class="st">"SELECT name FROM sqlite_master WHERE type='table';"</span>) <span class="co">#This specifically grabs all table names from our datbaase.</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> cur.fetchall()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>table_names <span class="op">=</span> [table[<span class="dv">0</span>] <span class="cf">for</span> table <span class="kw">in</span> tables] <span class="co">#Places them into a list</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"List of tables in the database:"</span>, table_names)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>conn.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of tables in the database: ['Maine', 'California', 'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'idaho-3166', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'new-hampshire', 'new-jersey', 'new-mexico', 'new-york', 'north-carolina', 'north-dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'rhode-island', 'south-carolina', 'south-dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'west-virginia', 'Wisconsin', 'Wyoming']</code></pre>
</div>
</div>
<p>Our tables aren’t completely in alphabetical order (I was testing around with Maine first, for instance). And some of them aren’t two words, like <code>south-dakota</code>, for instance. But if we compare this to what we have in <code>output</code>:</p>
<div id="cell-62" class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(output[<span class="st">'state'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>{'California (CA)',
 'Montana (MT)',
 'South Dakota (SD)',
 'Utah (UT)',
 'Washington (WA)',
 'Wyoming (WY)'}</code></pre>
</div>
</div>
<p>Here we have nice, capitalized state names with two-letter abbreviations. So, then, how are we going to fix this? We’re going to create a dictionary that essentially works as a mapping that takes what we have in <code>output</code> and matches it to what exists in <code>table_names</code> based on some matching criteria:</p>
<div id="cell-64" class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract unique states and sort them</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>unique_states_in_output <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(output[<span class="st">'state'</span>]), key<span class="op">=</span><span class="bu">str</span>.lower)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>table_names <span class="op">=</span> <span class="bu">sorted</span>(table_names, key<span class="op">=</span><span class="bu">str</span>.lower)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compare_letters(state_name, table_name):</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    clean_state_name <span class="op">=</span> <span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isalpha, state_name)).lower() <span class="co">#Eliminate non-alphabetical characters, condense together</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    clean_table_name <span class="op">=</span> <span class="st">''</span>.join(<span class="bu">filter</span>(<span class="bu">str</span>.isalpha, table_name)).lower()</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sorted</span>(clean_state_name) <span class="op">==</span> <span class="bu">sorted</span>(clean_table_name) <span class="co">#Gives a boolean value.</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>state_name_to_table_name <span class="op">=</span> {} <span class="co">#Create new dictionary</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> state_with_abbreviation <span class="kw">in</span> unique_states_in_output:</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    state_name <span class="op">=</span> state_with_abbreviation.split(<span class="st">' ('</span>)[<span class="dv">0</span>]  <span class="co"># Get rid of the parentheses in the abbreviation (like 'South Dakota (SD)')</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> <span class="bu">next</span>((table <span class="cf">for</span> table <span class="kw">in</span> table_names <span class="cf">if</span> compare_letters(state_name, table)), <span class="va">None</span>) <span class="co">#Generator based on whether or not names are the same</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match:</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>        state_name_to_table_name[state_with_abbreviation] <span class="op">=</span> match <span class="co">#Update dict if match found</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state_name_to_table_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'California (CA)': 'California', 'Montana (MT)': 'Montana', 'South Dakota (SD)': 'south-dakota', 'Utah (UT)': 'Utah', 'Washington (WA)': 'Washington', 'Wyoming (WY)': 'Wyoming'}</code></pre>
</div>
</div>
<p>Now that’s what we’re looking for! We do a few important things here:</p>
<p>Firstly, we make sure to get both the states that we have in <code>output</code> and the tables in <code>table_names</code> in alphabetical order. The reason why we do <code>key=str.lower</code> is because some of the table names are written in uppercase while others are in lowercase. This makes it case-insensitive.</p>
<p>Then we create a helper function called <code>compare_letters</code> which takes two state names (one from <code>output</code>, one from the database) and compares them to see if they have the same letters. We do this by filtering out non-alphabetical characters, spaces, and making everything lowercase and just checking if they have the same letters. The function will just return <code>True</code> or <code>False</code> depending on whether or not they match.</p>
<p>We actually use <code>state_name_to_table_name</code> in the <code>for</code> loop below this. We go through each of the states in <code>output</code>. Then, we extract just the part of the state name that comes before the two-letter abbreviation, and then we create a generator that individualls calls <code>compare_letters</code> on each of the names. If it returns <code>True</code>, then we have a match, which then causes the dictionary to be updated. Otherwise, nothing happens and we simply move onto the next entry (that’s why the second argument of <code>next</code> is <code>none</code>).</p>
<p>##Logic for linking databases</p>
<p>Our goal is to now go through each recommendation, and match up either the park or trail information corresponding to it (assuming that it’s present in the database). One issue that can arise with this, however, is that the name of the park in <code>output</code> might be different from that of the database. To mitigate this, we’re going to instead compare the coordinates of what’s in <code>output</code> to the rows inside of <code>trails_new.db</code> and <code>trails.db</code>. The idea is that if two parks are close enough to each other in terms of their coordinates, then they should represent the same thing. So, we’re going to make two functions that do similar (but different) things. One will be called <code>fetch_park_info_based_on_coords</code> which will look at parks (i.e., outside of California), and the other will be called <code>fetch_trail_info_based_on_coords</code></p>
<div id="cell-66" class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_park_info_based_on_coords(db_name, latitude, longitude, margin_lat, margin_long):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_name)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    cursor <span class="op">=</span> conn.cursor() <span class="co">#Connect to database</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> table_name <span class="kw">in</span> state_name_to_table_name.values(): <span class="co">#This is what we made earlier</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        cursor.execute(<span class="ss">f"SELECT * FROM </span><span class="ch">\"</span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ch">\"</span><span class="ss">"</span>) <span class="co">#Grab everything from the table</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>        rows <span class="op">=</span> cursor.fetchall()</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> row <span class="kw">in</span> rows: <span class="co">#For each row</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>            coords_text <span class="op">=</span> row[<span class="dv">2</span>]  <span class="co"># Coords are in the third column</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                coords <span class="op">=</span> <span class="bu">eval</span>(coords_text) <span class="co">#Kept as a tuple, essentially</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                lat_diff <span class="op">=</span> <span class="bu">abs</span>(coords[<span class="dv">0</span>] <span class="op">-</span> latitude)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                long_diff <span class="op">=</span> <span class="bu">abs</span>(coords[<span class="dv">1</span>] <span class="op">-</span> longitude)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> lat_diff <span class="op">&lt;</span> margin_lat <span class="kw">and</span> long_diff <span class="op">&lt;</span> margin_long:</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> row[<span class="dv">3</span>:]  <span class="co"># Don't need name and coords</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    conn.close()</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fetch_trail_info_based_on_coords(db_name, latitude, longitude, margin_lat, margin_long):</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(db_name)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    table_name <span class="op">=</span> <span class="st">'California'</span>  <span class="co">#Only getting CA trails</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>    cursor.execute(<span class="ss">f"SELECT * FROM </span><span class="sc">{</span>table_name<span class="sc">}</span><span class="ss">"</span>) <span class="co">#Grab everything</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    rows <span class="op">=</span> cursor.fetchall()</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> rows:</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>        coords_text <span class="op">=</span> row[<span class="dv">1</span>]  <span class="co"># Coords are in column 2</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>            coords <span class="op">=</span> <span class="bu">eval</span>(coords_text)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>            lat_diff <span class="op">=</span> <span class="bu">abs</span>(coords[<span class="dv">0</span>] <span class="op">-</span> latitude)</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>            long_diff <span class="op">=</span> <span class="bu">abs</span>(coords[<span class="dv">1</span>] <span class="op">-</span> longitude)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> lat_diff <span class="op">&lt;</span> margin_lat <span class="kw">and</span> long_diff <span class="op">&lt;</span> margin_long:</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> row[<span class="dv">2</span>:]</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span>:</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>  <span class="co"># Skip rows with invalid 'Coords'</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    conn.close()</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, so, it will make a lot more sense if we actually inspect the structure of our database again. Click the link below to see screenshots of two <code>.csv</code> files: the first of parks in Wyoming, and the second is of trails in California:</p>
<p>https://imgur.com/a/6fCixEt</p>
<p>With that out of the way, let’s dive into the code. We go through the mapping dictionary that we made previously and we grab all of the possible parks from each one. Then, we look at the third column (i.e., <code>row[2]</code>, which represents the third entry in the row) which corresponds to the coordinates (see screenshot), and we record the absolute difference in the coordinates between a given latitude and longitude (we’ll be taking those from <code>output</code>–they’re individual columns rather than a tuple). If both of them are within a specified margin of error, then we’ve found our match. Note that we’re only going to return everything starting from the third column: the first 2 are just the name and coordinates of the trail.</p>
<p>For <code>fetch_trail_info_based_on_coords</code>, we have a very similar set-up except for the fact that the coordinates are in the second column, and we’re interested in returning everything after the first two.</p>
<p>Now, let’s move on so we can see how we actually use these functions!</p>
</section>
<section id="putting-it-all-together" class="level2">
<h2 class="anchored" data-anchor-id="putting-it-all-together">Putting it all together</h2>
<p>The first thing we’re going to do is to specify the names of the new columns that we want to put into <code>california_df</code> and <code>non_california_df</code>. I’ve just grabbed these from the database:</p>
<div id="cell-68" class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>new_columns <span class="op">=</span> [</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Trails (view details)'</span>, <span class="st">'Total Distance'</span>, <span class="st">'State Ranking'</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Access Road/Trail'</span>, <span class="st">'White'</span>, <span class="st">'Green'</span>, <span class="st">'Blue'</span>, <span class="st">'Black'</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Double Black Diamond'</span>, <span class="st">'Proline'</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>new_trail_columns <span class="op">=</span> [</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Distance'</span>, <span class="st">'Avg time'</span>, <span class="st">'Climb'</span>, <span class="st">'Descent'</span>, <span class="st">'Activities'</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Riding Area'</span>, <span class="st">'Difficulty Rating'</span>, <span class="st">'Dogs Allowed'</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Local Popularity'</span>, <span class="st">'Altitude start'</span>, <span class="st">'Altitude end'</span>, <span class="st">'Grade'</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, all we need to do is iterate through the rows of <code>non_california_df</code> to match up the entires!</p>
<div id="cell-70" class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>margin_lat <span class="op">=</span> <span class="fl">0.1</span>  <span class="co"># Decently generous</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>margin_long <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> non_california_df.iterrows():</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">'Latitude'</span>]) <span class="kw">or</span> pd.isna(row[<span class="st">'Longitude'</span>]): <span class="co">#Some parks have NA coordinates</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    park_info <span class="op">=</span> fetch_park_info_based_on_coords(<span class="st">'trails_new (1).db'</span>, row[<span class="st">'Latitude'</span>], row[<span class="st">'Longitude'</span>], margin_lat, margin_long)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Remember, this grabs almost all of the columns if a match is found</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> park_info:</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        non_california_df.loc[index, new_columns] <span class="op">=</span> park_info <span class="co">#We can mass-add new columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the above code, we use the <code>fetch_park_info_based_on_coords</code> function to essentially create a new data frame that contains the information that we want once we match the coordinates. Then, we insert all of these as new columns, taking advantage of the <code>.loc()</code> method from <code>pandas</code>. Now let’s do the same thing for the California <code>df</code>:</p>
<div id="cell-72" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> california_df.iterrows():</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.isna(row[<span class="st">'Latitude'</span>]) <span class="kw">or</span> pd.isna(row[<span class="st">'Longitude'</span>]):</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    park_info <span class="op">=</span> fetch_trail_info_based_on_coords(<span class="st">'trails.db'</span>, row[<span class="st">'Latitude'</span>], row[<span class="st">'Longitude'</span>], margin_lat, margin_long)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> park_info <span class="kw">and</span> <span class="bu">len</span>(park_info) <span class="op">==</span> <span class="bu">len</span>(new_trail_columns):</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        california_df.loc[index, new_trail_columns] <span class="op">=</span> park_info</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, let’s take a look at our results!</p>
<div id="cell-74" class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>non_california_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Trails (view details)</th>
<th data-quarto-table-cell-role="th">Total Distance</th>
<th data-quarto-table-cell-role="th">State Ranking</th>
<th data-quarto-table-cell-role="th">Access Road/Trail</th>
<th data-quarto-table-cell-role="th">White</th>
<th data-quarto-table-cell-role="th">Green</th>
<th data-quarto-table-cell-role="th">Blue</th>
<th data-quarto-table-cell-role="th">Black</th>
<th data-quarto-table-cell-role="th">Double Black Diamond</th>
<th data-quarto-table-cell-role="th">Proline</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">303</td>
<td>Badlands National Park</td>
<td>South Dakota (SD)</td>
<td>Pinnacles Overlook</td>
<td>Points of Interest &amp; Landmarks</td>
<td>5.0</td>
<td>Must See Pullover</td>
<td>5.0 of 5 bubbles</td>
<td>This is one of a handful of overlooks you have...</td>
<td>43.75</td>
<td>-102.50</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">235</td>
<td>Arches National Park</td>
<td>Utah (UT)</td>
<td>Delicate Arch</td>
<td>Points of Interest &amp; Landmarks</td>
<td>5.0</td>
<td>Delicate Arch</td>
<td>5.0 of 5 bubbles</td>
<td>Our family chose to hike to Delicate Arch late...</td>
<td>38.68</td>
<td>-109.57</td>
<td>...</td>
<td>40</td>
<td>50 miles</td>
<td>#7,493</td>
<td>6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">863</td>
<td>Capitol Reef National Park</td>
<td>Utah (UT)</td>
<td>Capitol Reef National Park</td>
<td>National Parks</td>
<td>4.5</td>
<td>Add Capitol Reef to Your Utah National Park List</td>
<td>5.0 of 5 bubbles</td>
<td>Just to the northeast of more popular parks Br...</td>
<td>38.20</td>
<td>-111.17</td>
<td>...</td>
<td>60</td>
<td>194 miles</td>
<td>#9,609</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1611</td>
<td>Grand Teton National Park</td>
<td>Wyoming (WY)</td>
<td>Taggart Lake</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Do this hike if you want to feel like you're a...</td>
<td>5.0 of 5 bubbles</td>
<td>It's not a difficult hike and is right off the...</td>
<td>43.73</td>
<td>-110.80</td>
<td>...</td>
<td>26</td>
<td>53 miles</td>
<td>#4,761</td>
<td>1.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">222</td>
<td>Arches National Park</td>
<td>Utah (UT)</td>
<td>Double Arch</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Easy hike</td>
<td>5.0 of 5 bubbles</td>
<td>The Double Arch is unreal. It is massive and b...</td>
<td>38.68</td>
<td>-109.57</td>
<td>...</td>
<td>40</td>
<td>50 miles</td>
<td>#7,493</td>
<td>6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3198</td>
<td>Mount Rainier National Park</td>
<td>Washington (WA)</td>
<td>Sunrise Visitor Center</td>
<td>Visitor Centers</td>
<td>4.5</td>
<td>Amazing views</td>
<td>5.0 of 5 bubbles</td>
<td>Amazing hikes of all varieties. Many travel up...</td>
<td>46.85</td>
<td>-121.75</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1439</td>
<td>Glacier National Park</td>
<td>Montana (MT)</td>
<td>Grinnell Glacier</td>
<td>Hiking Trails</td>
<td>5.0</td>
<td>Incredible vies and the end-point is rewarding</td>
<td>5.0 of 5 bubbles</td>
<td>This 13 mile hike from Many Glacier to upper G...</td>
<td>48.80</td>
<td>-114.00</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1366</td>
<td>Glacier National Park</td>
<td>Montana (MT)</td>
<td>Virginia Falls</td>
<td>Waterfalls</td>
<td>5.0</td>
<td>Magnificent Falls in Glacier National Park - w...</td>
<td>5.0 of 5 bubbles</td>
<td>This is the second falls on a hike in Glacier ...</td>
<td>48.80</td>
<td>-114.00</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">650</td>
<td>Canyonlands National Park</td>
<td>Utah (UT)</td>
<td>Horseshoe Canyon</td>
<td>Canyons</td>
<td>5.0</td>
<td>WHOA! READ PLEASE. Things you NEED to know a...</td>
<td>5.0 of 5 bubbles</td>
<td>There are some older reviews. Some are VERY M...</td>
<td>38.20</td>
<td>-109.93</td>
<td>...</td>
<td>25</td>
<td>177 miles</td>
<td>#9,011</td>
<td>9.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>9 rows × 22 columns</p>
</div>
</div>
</div>
<p>Success! It looks like we unfortunately have a few NA values. Unfortunately, it’s hard to guarantee precision in the coordinates. We only had one trail for California:</p>
<div id="cell-76" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>california_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">national_park</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">trail</th>
<th data-quarto-table-cell-role="th">activity</th>
<th data-quarto-table-cell-role="th">overall_rating</th>
<th data-quarto-table-cell-role="th">comment_title</th>
<th data-quarto-table-cell-role="th">comment_ratings</th>
<th data-quarto-table-cell-role="th">comment_text</th>
<th data-quarto-table-cell-role="th">Latitude</th>
<th data-quarto-table-cell-role="th">Longitude</th>
<th data-quarto-table-cell-role="th">Area</th>
<th data-quarto-table-cell-role="th">Visitors (2018)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1310</td>
<td>Death Valley National Park</td>
<td>California (CA)</td>
<td>Zabriskie Point</td>
<td>Geologic Formations</td>
<td>4.5</td>
<td>The Most Iconic Place in Death Valley</td>
<td>4.0 of 5 bubbles</td>
<td>You can't miss it. I don't mean you have to do...</td>
<td>36.24</td>
<td>-116.82</td>
<td>3,373,063.14 acres (13,650.3 km2)</td>
<td>1678660</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Wait, really? I thought we would’ve had this for sure in our database…</p>
<p>On closer inspection, we actually do, but hte coordinates on TrailForks versus what we got from the National Park data is a bit off. On the TrailForks page for Zabriskie Point, the coordinates are (36.420820, -116.810120), which is just outside the margin of error.</p>
</section>
</section>
<section id="ethical-ramifications-and-concluding-remarks" class="level1">
<h1>Ethical Ramifications and Concluding Remarks</h1>
<p>We have no control over what users do with the recommendations that they receive. This could mean that, based on certain criteria, that they engage in malicious behavior on certain trails, for example, or they may attempt to monetize the results from our tool despite the fact that we’d like it to be freely available. Even if we include disclaimers, warnings, or agreements that users have to abide by, once a recommendation is generated, it’s out of our hands.</p>
<p>As for biases, language processing tools may only be used to certain linguistic conventions, which may prioritize the results from certain reviews over others. We don’t have experience using NLP, so this is something that we anticipate having to address as we go along. See “Risks” above.</p>
<p>All in all, we think that we executed our project well on the technical portion. We gave users most similar trails based upon reviews and supplemented this information by merging these similar trails with the numeric data on TrailForks. We think we could improve by implementing this onto a website better such that the person does not have to open our Jupyter Files and manually input the trails they want.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>